<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>

    <!-- 구글폰트 -->
    <link
      href="https://fonts.googleapis.com/css?family=Stylish&display=swap"
      rel="stylesheet"
    />
    <!-- font awesome 추가 -->
    <script
      src="https://kit.fontawesome.com/28653e43c1.js"
      crossorigin="anonymous"
    ></script>
    <script src="/static/scripts/main.js"></script>
    <link rel="stylesheet" href="/static/styles/main.css" />
    <link rel="stylesheet" href="/static/styles/reset.css" />
    <link rel="stylesheet" href="/static/styles/common.css" />
    <title>Main Page</title>

    <script></script>
  </head>
  <body>
    <header id="header">
      <h1>
        <a href="/"
          ><img class="logo" src="../static/imgs/logo.PNG" alt="오늘 뭐먹지?"
        /></a>
      </h1>
      <div onclick="nav_show()" class="user">
        <span class="user-name"
          ><span class="user-name-db">{{ nickname }}</span>님</span
        >
        <img src="https://picsum.photos/id/237/200/300" alt="프로필" />
      </div>
      <div class="nav" onclick="sign_out()">로그아웃</div>
    </header>
    <div class="main-container">
      <div class="recommend-container">
        <h2>추천 드려요~!</h2>
        <h4>오늘의 건강식을 추천드립니다. 확인해보세요!</h4>
        <div class="image-container">
          {% for dish in recommends %}
          <div class="dish">
            <a href="/detail/{{ dish.no }}">
              <img src="{{ dish.img }}" alt="dish-image" />
              <div class="dish-desc">
                <p class="dish-name">{{ dish.menu_name }}</p>
                <p class="dish-type">{{ dish.menu_type }}</p>
              </div>
            </a>
          </div>
          {% endfor %}
        </div>
        <button class="recommend-btn" onclick="show_modal()">
          마음에 드는 게 없다면?
        </button>
      </div>
      <div class="list-container">
        <h2>건강한 레시피를 찾아보세요!</h2>
        <h4>원하시는 재료를 검색해서 건강한 음식을 찾아보세요!</h4>
        <form class="search-form" onsubmit="search_ingredients()">
          <input type="text" class="search-input" placeholder="재료 입력" />
          <button type="submit" class="search-btn">찾기</button>
        </form>
        <div class="dish-lists">
          {% for dish in dishes %} {% set class_heart = "" %} {% if
          dish["like_by_me"] %} {% set class_heart = "fa-heart" %} {% else %} {%
          set class_heart = "fa-heart-o" %} {% endif %}
          <div id="{{ dish.no }}" class="dish">
            <a href="/detail/{{ dish.no }}">
              <div class="img-wrap">
                <img src="{{ dish.img }}" alt="dish-image" />
              </div>
              <div class="description">
                <p class="dish-type">{{ dish.menu_type }}</p>
                <h3 class="dish-name">{{ dish.menu_name }}</h3>
              </div>
            </a>
            <a
              class="level-item"
              aria-label="heart"
              onclick="toggle_like('{{ dish.no }}', 'heart')"
            >
              <i class="fa {{ class_heart }}" aria-hidden="true"></i>
              <span class="like-num">{{ dish.count_like }}</span></a
            >
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- 모달 -->
      <div class="modal hidden">
        <div class="modal-contents">
          <h1>질문에 답해주세요.</h1>
          <div class="question-wrap">
            <div class="questions-container">
              <h3 class="question">질문. 밥드실래요? 디저트드실래요?</h3>
              <label class="box-radio-input"
                ><input
                  type="radio"
                  name="item_type"
                  value="밥"
                  checked="checked"
                /><span>밥</span></label
              >
              <label class="box-radio-input"
                ><input type="radio" name="item_type" value="후식" /><span
                  >후식</span
                ></label
              >
            </div>

            <div class="questions-container">
              <h3 class="question">질문. 끓이기? 굽기?</h3>
              <label class="box-radio-input"
                ><input
                  type="radio"
                  name="item_howto"
                  value="끓이기"
                  checked="checked"
                /><span>끓이기</span></label
              >
              <label class="box-radio-input"
                ><input type="radio" name="item_howto" value="굽기" /><span
                  >굽기</span
                ></label
              >
            </div>

            <div class="questions-container">
              <h3 class="question">질문. 다이어트식? 보양식?</h3>
              <label class="box-radio-input"
                ><input
                  type="radio"
                  name="item_cal"
                  value="다이어트식"
                  checked="checked"
                /><span>다이어트식</span></label
              >
              <label class="box-radio-input"
                ><input type="radio" name="item_cal" value="보양식" /><span
                  >보양식</span
                ></label
              >
            </div>
          </div>
          <div class="control-container">
            <button class="prev" id="prev">prev</button>
            <button class="next" id="next">next</button>
            <button class="submit hide" id="submit">submit</button>
          </div>
          <button class="exit-btn" onclick="hide_modal()">X</button>
        </div>
      </div>

      <footer id="footer">© 2021 오늘뭐먹지? by 5조</footer>
    </div>
  </body>
  <script>
    let idx = 0;

    const controlContainer = document.querySelector(".control-container");
    const questionWrap = document.querySelector(".question-wrap");
    const questions = document.querySelectorAll(".questions-container");
    const prevBtn = document.querySelector(".prev");
    const nextBtn = document.querySelector(".next");
    const submitBtn = document.querySelector(".submit");
    const modalHideBtn = document.querySelector(".exit-btn");

    console.log(questions.length);

    controlContainer.addEventListener("click", (e) => {
      if (e.target.id === "prev") {
        idx--;
        moveQuestion();
      } else if (e.target.id === "next") {
        idx++;
        moveQuestion();
      }
    });

    function moveQuestion() {
      if (idx === questions.length - 1) {
        console.log("마지막 질문");
        nextBtn.classList.add("hide");
        submitBtn.classList.remove("hide");
        idx = questions.length - 1;
      } else if (idx < 0) {
        idx = 0;
      } else {
        nextBtn.classList.remove("hide");
        submitBtn.classList.add("hide");
      }

      questionWrap.style.transform = `translateX(${-idx * 900}px)`;
    }

    submitBtn.addEventListener("click", (e) => {
      const answerType = document.querySelector(
        'input[name="item_type"]:checked'
      ).value;
      const answerHowto = document.querySelector(
        'input[name="item_howto"]:checked'
      ).value;
      const answerCal = document.querySelector(
        'input[name="item_cal"]:checked'
      ).value;

      const answers = [answerType, answerHowto, answerCal];
      console.log(answers);

      // 메뉴 한 개 추천받으러
      $.ajax({
        type: "POST",
        url: "/api/recommend_food",
        data: {
            "answers_give": answers
        },
        success: function (response) {
            if (response["result"] == "success") {
                let recommended_dish = response['food']
                let temp_html =`
                <a href="/detail/{{ recommended_dish.no }}">
                    <div class="img-wrap">
                        <img src="{{ recommended_dish.img }}" alt="dish-image" />
                    </div>
                    <div class="description">
                        <p class="dish-type">{{ recommended_dish.menu_type }}</p>
                        <h3 class="dish-name">{{ recommended_dish.menu_name }}</h3>
                    </div>
                </a>
                <a
                class="level-item"
                aria-label="heart"
                onclick="toggle_like('{{ recommended_dish.no }}', 'heart')"
                >
                    <i class="fa {{ class_heart }}" aria-hidden="true"></i>
                    <span class="like-num">{{ recommended_dish.count_like }}</span></a
                >`
                $('#modal-contents').append(temp_html)
            }
        },
      });
    });
  </script>
    <script>
    let dishes = {{ dishes|tojson }};
    $(document).ready(function () {
        $(".search-form").on("submit", function (e) {
            e.preventDefault();
            let words = $(".search-input").val();
            $(".search-input").val("");
            $('#ds').empty();
            let existWords = false;
            for (let i = 0; i < dishes.length; i++) {

                if (dishes[i]["ingredient"].includes(words)) {

                    let dish_no = dishes[i]['no'];
                    let dish_img = dishes[i]['img'];
                    let dish_name = dishes[i]["menu_name"];
                    let dish_type = dishes[i]["menu_type"];
                    let temp_html =
                        `<div  class="dish">
                         <a href="/detail/${dish_no}">
                         <div class="img-wrap">
                         <img src="${dish_img}" alt="dish-image"/>
                         </div>
                         <div class="description">
                         <p class="dish-type">${dish_type}</p>
                         <h3 class="dish-name">${dish_name}</h3>
                         </div>
                         </a>
                         <i class="far fa-heart" onclick="likeHeart()"></i>
                         </div>`;
                    $('#ds').append(temp_html);
                    existWords = true;

                }
            }
            if (existWords == false){
                alert("없는 재료입니다");
                window.location.href = `/`
            }
        });
    });
    </script>

    // modalHideBtn.addEventListener("click", (e) => {
    //   questionWrap.style.transform = `translateX(0)`;
    // });

</html>
